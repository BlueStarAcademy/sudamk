# 프로덕션 배포 체크리스트

프로덕션 환경에 배포하기 전에 확인해야 할 사항들입니다.

## 사전 배포 체크리스트

### 환경 변수 설정

**백엔드 (API):**
- [ ] `DATABASE_URL` - 프로덕션 데이터베이스 URL
- [ ] `JWT_SECRET` - JWT 토큰 서명용 시크릿 키 (최소 32자)
- [ ] `NODE_ENV=production` - 프로덕션 환경 설정
- [ ] `PORT` - 서버 포트 (Railway는 자동 설정)
- [ ] `ALLOWED_ORIGINS` - 허용된 프론트엔드 도메인 (쉼표로 구분)

**프론트엔드 (Web):**
- [ ] `NEXT_PUBLIC_API_URL` - 백엔드 API 공개 도메인 (필수)
- [ ] `NODE_ENV=production` - 프로덕션 환경 설정

### 데이터베이스

- [ ] 프로덕션 데이터베이스 생성 및 연결 확인
- [ ] Prisma 마이그레이션 실행 (`pnpm db:migrate`)
- [ ] 데이터베이스 백업 설정
- [ ] 연결 풀 설정 확인

### 보안

- [ ] 환경 변수 보안 확인 (시크릿 키 노출 방지)
- [ ] CORS 설정 확인
- [ ] Rate limiting 설정 (필요시)
- [ ] HTTPS 설정 확인
- [ ] 인증 토큰 만료 시간 확인

### 성능

- [ ] 데이터베이스 인덱스 확인
- [ ] 캐싱 전략 확인
- [ ] 로깅 레벨 설정 (프로덕션: info, 필요시 error로 변경 가능)
- [ ] 메모리 사용량 모니터링 설정
- [ ] 게임 루프 간격 확인 (기본: 10초)
- [ ] 액션 포인트 재생성 간격 확인

### 테스트

- [ ] 모든 테스트 통과 확인
- [ ] E2E 테스트 통과 확인
- [ ] 성능 테스트 통과 확인
- [ ] 스트레스 테스트 (선택사항)

### 빌드

- [ ] 백엔드 빌드 성공 확인
- [ ] 프론트엔드 빌드 성공 확인
- [ ] 빌드 아티팩트 크기 확인
- [ ] 환경 변수 주입 확인

## 배포 단계

### 1. 개발 환경에서 최종 확인

```bash
# 배포 준비 상태 확인 (빠른 체크)
pnpm check:deployment

# 상세 배포 준비 확인
pnpm prepare:production

# 테스트 포함 확인
pnpm prepare:production:test

# 테스트 실행
pnpm test

# 빌드 확인
pnpm build

# 로컬에서 실행 테스트
pnpm dev
```

### 2. 스테이징 환경 배포 (선택사항)

- [ ] 스테이징 환경에 배포
- [ ] 스테이징 환경에서 테스트
- [ ] 사용자 승인 테스트

### 3. 프로덕션 배포

- [ ] 프로덕션 브랜치로 머지 (`main`)
- [ ] CI/CD 파이프라인 통과 확인
- [ ] 자동 배포 실행 또는 수동 배포
- [ ] 배포 로그 확인

### 4. 배포 후 확인

```bash
# 자동 검증 스크립트 실행
pnpm verify:deployment https://your-backend-domain.railway.app
```

또는 수동 확인:

- [ ] 헬스체크 엔드포인트 확인 (`/health`)
- [ ] API 엔드포인트 동작 확인 (`/api`)
- [ ] 프론트엔드 로드 확인
- [ ] 데이터베이스 연결 확인
- [ ] WebSocket 연결 확인
- [ ] 에러 로그 모니터링
- [ ] 기능 테스트 (등록, 로그인, 게임 생성 등)

## 롤백 계획

배포 실패 시 롤백 절차:

1. 이전 버전으로 롤백
2. 데이터베이스 마이그레이션 롤백 (필요시)
3. 문제 원인 분석
4. 수정 후 재배포

## 모니터링

배포 후 모니터링할 메트릭:

- [ ] API 응답 시간
- [ ] 에러율
- [ ] 데이터베이스 쿼리 성능
- [ ] 메모리 사용량
- [ ] CPU 사용량
- [ ] 활성 사용자 수
- [ ] WebSocket 연결 수

## 알림 설정

- [ ] 에러 알림 설정
- [ ] 성능 저하 알림 설정
- [ ] 다운타임 알림 설정

## 문서화

- [ ] 배포 문서 업데이트
- [ ] 환경 변수 문서 업데이트
- [ ] 트러블슈팅 가이드 업데이트

