# Railway Resource Limits 설정 가이드

## 현재 설정
- **CPU**: 4 vCPU
- **Memory**: 8 GB

## 분석

### 1. 메모리 사용량 분석

**현재 상태:**
- 기본 메모리: ~150-160MB
- Heap: ~30-50MB / 70-80MB

**동시 사용자별 예상 메모리:**
```
기본 메모리: 150MB
+ 사용자당 메모리: 8MB (WebSocket, 캐시, 게임 상태 등)
= 총 메모리 필요량
```

| 동시 사용자 수 | 예상 메모리 | 권장 설정 | 여유 메모리 |
|-------------|-----------|---------|-----------|
| 50명        | ~550MB    | 2 GB    | 1.5 GB   |
| 100명       | ~950MB    | 4 GB    | 3 GB     |
| 200명       | ~1.75GB   | 4 GB    | 2.25 GB  |
| 500명       | ~4.15GB   | **8 GB** | **3.85 GB** |
| 1000명      | ~8.15GB   | 16 GB   | 7.85 GB  |

### 2. CPU 사용량 분석

**현재 상태:**
- Node.js는 단일 스레드이지만, 비동기 I/O 처리
- 4 vCPU는 충분한 성능 제공

**CPU 집약적 작업:**
- KataGo 분석 (HTTP API 모드 사용 시 부하 적음)
- 랭킹 캐시 계산 (비동기 처리)
- 게임 상태 업데이트

**권장 설정:**
- 100명 이하: 2-4 vCPU
- 500명: 4-8 vCPU
- 1000명: 8-16 vCPU

## 최대 설정(32 vCPU / 32 GB)의 문제점

### ❌ 문제점

1. **비용 증가**
   - Railway는 사용량 기반 과금
   - 실제 사용하지 않는 리소스에 대한 비용 지불
   - 32GB는 현재 사용량(150MB)의 **200배 이상**

2. **리소스 낭비**
   - Railway 플랫폼 전체 리소스는 한정적
   - 과도한 할당은 다른 서비스와 공유하는 리소스를 낭비
   - 데이터베이스 등 다른 서비스와 리소스를 공유

3. **성능 향상 없음**
   - Node.js 애플리케이션은 단일 스레드 기반
   - CPU를 32개로 늘려도 성능 향상은 제한적
   - 메모리가 충분하면 CPU는 4-8개면 충분

4. **실제 사용량과 불일치**
   - 현재 메모리: 150MB
   - 32GB 할당: 약 99.5% 미사용

### ✅ 적절한 설정

**현재 설정 (4 vCPU / 8 GB)가 적절한 이유:**
- 500명 동시 사용자 대응 가능
- 여유 메모리 3-4GB (버퍼)
- 비용 효율적
- 성능과 비용의 균형

## 동시 사용자별 권장 설정

### 소규모 (50명 이하)
```
CPU: 2 vCPU
Memory: 2 GB
비용: 최소
```

### 중규모 (100-200명)
```
CPU: 4 vCPU
Memory: 4 GB
비용: 중간
```

### 대규모 (500명)
```
CPU: 4-8 vCPU
Memory: 8 GB  ← 현재 설정
비용: 중상
```

### 초대규모 (1000명 이상)
```
CPU: 8-16 vCPU
Memory: 16 GB
비용: 높음
```

## 메모리 사용량 모니터링

### 현재 메모리 사용량 확인
Railway Dashboard → Metrics 탭에서 다음을 확인:
- **Memory Usage**: 실제 사용량
- **Memory Limit**: 설정된 제한
- **Memory Utilization**: 사용률 (%)

### 모니터링 기준
- **60% 이하**: 적절함
- **60-80%**: 여유 있음
- **80-90%**: 주의 (리소스 증가 고려)
- **90% 이상**: 위험 (즉시 리소스 증가 필요)

## CPU 사용량 모니터링

### 현재 CPU 사용량 확인
Railway Dashboard → Metrics 탭에서 다음을 확인:
- **CPU Usage**: 실제 사용률
- **CPU Utilization**: 평균 사용률

### 모니터링 기준
- **50% 이하**: 적절함 (여유 있음)
- **50-70%**: 적절함
- **70-85%**: 주의 (부하 증가 시 문제 가능)
- **85% 이상**: 위험 (리소스 증가 고려)

## 결론 및 권장사항

### ✅ 현재 설정 (4 vCPU / 8 GB) 유지 권장

**이유:**
1. **충분한 성능**: 500명 동시 사용자 대응 가능
2. **비용 효율적**: 실제 사용량 대비 적절
3. **여유 공간**: 버퍼 메모리 3-4GB 확보
4. **확장 가능**: 필요 시 쉽게 증가 가능

### ⚠️ 최대 설정(32 vCPU / 32 GB)은 권장하지 않음

**이유:**
1. **비용 낭비**: 실제 사용량 대비 200배 이상
2. **성능 향상 없음**: Node.js 특성상 CPU 4-8개면 충분
3. **리소스 낭비**: Railway 플랫폼 리소스 낭비

### 📊 모니터링 후 조정

1. **메모리 사용률이 80% 이상 지속되면**
   - 8GB → 16GB 증가 고려

2. **CPU 사용률이 85% 이상 지속되면**
   - 4 vCPU → 8 vCPU 증가 고려

3. **동시 사용자 수가 1000명 이상이면**
   - 리소스 전체 증가 고려

## 비용 최적화 팁

1. **실제 사용량 모니터링**: Metrics 탭에서 지속적으로 확인
2. **점진적 증가**: 필요 시 단계적으로 증가
3. **피크 시간 고려**: 최대 부하 시 리소스 확인
4. **캐싱 최적화**: 데이터베이스 쿼리 감소로 메모리/CPU 절약

