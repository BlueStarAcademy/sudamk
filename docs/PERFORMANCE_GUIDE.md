# 성능 최적화 가이드

이 문서는 SUDAM v2 프로젝트의 성능 최적화 전략과 모니터링 방법을 설명합니다.

## 성능 최적화 전략

### 1. 데이터베이스 최적화

#### 인덱스 활용
- 자주 조회되는 필드에 인덱스 추가
- 복합 인덱스 사용 (예: `userId + createdAt`)
- Prisma 스키마에서 `@@index` 사용

#### 쿼리 최적화
- 필요한 필드만 선택 (`select` 사용)
- 관계 데이터는 필요할 때만 `include`
- 배치 쿼리 사용 (여러 쿼리를 하나로)

#### 연결 풀링
- Prisma는 기본적으로 연결 풀링 사용
- 환경 변수로 연결 수 조정 가능

### 2. 캐싱 전략

#### 인메모리 캐시
- 자주 조회되는 사용자 정보 캐싱
- 게임 상태 캐싱 (짧은 TTL)
- TTL 기반 자동 만료

#### 캐시 무효화
- 데이터 업데이트 시 관련 캐시 삭제
- 사용자 업데이트 시 사용자 캐시 무효화

### 3. API 최적화

#### tRPC 최적화
- 필요한 데이터만 반환
- 중첩 쿼리 최소화
- 배치 요청 사용

#### WebSocket 최적화
- 필요한 클라이언트에게만 브로드캐스트
- 메시지 압축 고려
- 연결 풀 관리

### 4. 프론트엔드 최적화

#### React 최적화
- `useMemo`, `useCallback` 사용
- 불필요한 리렌더링 방지
- 코드 스플리팅

#### 상태 관리 최적화
- Zustand 선택적 구독
- 필요한 상태만 구독
- 로컬 상태와 전역 상태 분리

## 성능 모니터링

### 메트릭 수집

#### 백엔드 메트릭
- API 응답 시간
- 데이터베이스 쿼리 시간
- 메모리 사용량
- CPU 사용량

#### 프론트엔드 메트릭
- 페이지 로드 시간
- 컴포넌트 렌더링 시간
- API 호출 시간
- 번들 크기

### 로깅

#### 성능 로그
- 느린 쿼리 로깅
- API 응답 시간 로깅
- 에러 발생 시 컨텍스트 로깅

## 성능 테스트

### 부하 테스트

```bash
# API 부하 테스트 (예시)
# Apache Bench 사용
ab -n 1000 -c 10 http://localhost:3000/api/health
```

### 프로파일링

```bash
# Node.js 프로파일링
node --prof src/index.ts
node --prof-process isolate-*.log
```

## 최적화 체크리스트

### 데이터베이스
- [ ] 필요한 인덱스 추가
- [ ] 쿼리 최적화 (N+1 문제 해결)
- [ ] 연결 풀 설정 최적화

### 캐싱
- [ ] 자주 조회되는 데이터 캐싱
- [ ] 캐시 무효화 전략 구현
- [ ] 캐시 히트율 모니터링

### API
- [ ] 응답 크기 최소화
- [ ] 배치 요청 지원
- [ ] 페이지네이션 구현

### 프론트엔드
- [ ] 번들 크기 최적화
- [ ] 이미지 최적화
- [ ] 레이지 로딩 구현

## 성능 목표

### 백엔드
- API 응답 시간: < 200ms (평균)
- 데이터베이스 쿼리: < 100ms (평균)
- 동시 연결: 1000+ WebSocket 연결

### 프론트엔드
- 첫 화면 로드: < 2초
- 페이지 전환: < 500ms
- 번들 크기: < 500KB (초기 로드)

## 모니터링 도구

- **APM**: New Relic, Datadog, 또는 자체 모니터링
- **로깅**: Pino (백엔드), 브라우저 콘솔 (프론트엔드)
- **메트릭**: Prometheus + Grafana (선택사항)

## 참고 자료

- [Prisma 성능 가이드](https://www.prisma.io/docs/guides/performance-and-optimization)
- [Fastify 성능 가이드](https://www.fastify.io/docs/latest/Guides/Performance/)
- [Next.js 성능 최적화](https://nextjs.org/docs/app/building-your-application/optimizing)

